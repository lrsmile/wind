#! /usr/bin/env node



var program  = require("commander");
var path = require('path');
var appInfo = require('../package.json');
var fs = require('fs-extra')

var templatsDir   =  path.join(__dirname, '..', 'templates', "");
var appName;


program
    .version(appInfo.version)
    .usage('[options] [dir]')
    .option('-d, --desc <dec>', '项目介绍')
    .option('-ar, --author <author>', '项目作者')
    .parse(process.argv);


// Path
var destinationPath = program.args.shift() || '.';

// 项目名称
var appName;
if(destinationPath == ".")
    appName = "./";
else
    appName =path.basename(path.resolve(destinationPath))+"/";


fs.copy(templatsDir,appName, function (err) {
    if (err)  throw  err;
    console.log('   \x1b[36mcreate\x1b[0m : ' + "project...");
    updateProject();
})


function updateProject (){

    var packageJson = {
        "name": "wind",
        "version": "1.0.0",
        "private": true,
        "scripts": {
            "start": "node ./bin/www"
        },
        "description" : "is Fast build Front and rear decoupling  node  project startup",
        "author" : "",
        "dependencies": {
            "body-parser": "~1.12.0",
            "cookie-parser": "~1.3.4",
            "debug": "~2.1.1",
            "express": "~4.12.2",
            "morgan": "~1.5.1",
            "serve-favicon": "~2.2.0",
            "ejs"  : "*",
            "log4js" : "*",
            "mobile-agent" : "*",
            "urllib" : "*"
        }
    }


    packageJson.name = appName || "wind";

    if(program.desc)
        packageJson.description =  program.desc;

    if(program.author)
        packageJson.author =  program.author;

    write(appName+'package.json', JSON.stringify(packageJson,null,2));


    console.log('   \x1b[36msuccess\x1b[0m: '+"project create success...");
}


function loadTemplate(name) {
    return fs.readFileSync(path.join(__dirname, '..', 'templates', name), 'utf-8');
}

/**
 * echo str > path.
 *
 * @param {String} path
 * @param {String} str
 */

function write(path, str, mode) {
    fs.writeFileSync(path, str, { mode: mode || 0666 });
    console.log('   \x1b[36mcreate\x1b[0m : ' + path+"...");
}






















